<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Envolve</title>
</head>
<body>
	<script src="socket.io/socket.io.js"></script>
	<script src="main.js"></script>
	<script>
		const app = Elm.Main.init();

		app.ports.connect.subscribe(function (name) {
			const socket = io(`${window.location.host}?userName=${name}&roomId=${window.location.pathname.slice(1)}`);

			socket.on('disconnect', () => window.location.assign(`${window.location.protocol}//${window.location.host}`));

			socket.on('connect', () => app.ports.connected.send(null));

			socket.on('new user', ({ userName }) => app.ports.userJoined.send(userName));

			socket.on('user left', ({ userName }) => app.ports.userLeft.send(userName));

			socket.on('managing', ({ roomId }) => app.ports.managing.send(`${window.location.protocol}//${window.location.host}/${roomId}`));

			socket.on('start poll', () => app.ports.pollStarting.send(null));

			socket.on('cast vote', ({ vote }) => app.ports.recievedVote.send(vote));

			app.ports.startPoll.subscribe(function () {
				socket.emit('start poll');
			});

			app.ports.castVote.subscribe(function (vote) {
				socket.emit('cast vote', { vote });
			});
		});
	</script>
</body>
</html>